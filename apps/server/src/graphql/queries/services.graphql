query services($projectId: String!, $after: String, $first: Int) {
  project(id: $projectId) {
    id
    name
    services(after: $after, first: $first) {
      edges {
        cursor
        node {
          ...ServiceWithDeployment
        }
      }
      pageInfo {
        hasNextPage
        hasPreviousPage
        startCursor
        endCursor
      }
    }
  }
}

fragment ServiceBasic on Service {
  id
  name
  icon
  projectId
  createdAt
  updatedAt
  deletedAt
  templateServiceId
  templateThreadSlug
}

fragment ServiceWithDeployment on Service {
  ...ServiceBasic
  project {
    id
    name
    isPublic
  }
  deployments(first: 1) {
    edges {
      node {
        id
        status
        createdAt
        updatedAt
        staticUrl
        url
        environmentId
        canRedeploy
        canRollback
        snapshotId
        deploymentStopped
        suggestAddServiceDomain
        creator {
          avatar
          email
          name
        }
        environment {
          id
          name
        }
        instances {
          status
        }
        sockets {
          port
          processName
          ipv6
          updatedAt
        }
      }
    }
  }
  serviceInstances(first: 10) {
    edges {
      node {
        id
        environmentId
        serviceName
        region
        builder
        buildCommand
        startCommand
        healthcheckPath
        healthcheckTimeout
        numReplicas
        restartPolicyType
        restartPolicyMaxRetries
        sleepApplication
        cronSchedule
        rootDirectory
        source {
          image
          repo
        }
        upstreamUrl
        createdAt
        updatedAt
      }
    }
  }
  featureFlags
}
